<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة استهلاك المياه</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
body {

font-family: Arial, sans-serif;
margin: 0;
padding: 0px;
background-color: #f0f0f0;
}
#container {
max-width: 100%;
background-color: white;
border: 2px solid #000;
}
h1 {
text-align: center;
font-size: 18px;
margin-bottom: 20px;
}
.form-group {
margin-bottom: 10px;
}
label {
display: inline-block;
}
input {
padding: 5px;
text-align: center;
font-weight: bold;
}
table {
width: 100%;
border-collapse: collapse;
margin-top: 5px;
}
th, td {
border: 1px solid #000;
padding: 8px;
text-align: center;
}

button {
display: block;
width: 100%;
padding: 10px;
background-color: #4CAF50;
color: white;
border: none;
cursor: pointer;
margin-top: 20px;

}

#main {
      width: 100%; /* عرض الحاوية الأصلية 100% */
      display: flex; /* استخدام flexbox لضبط الحاويتين الداخلية جنبًا إلى جنب */
  }

  /* الحاوية التي تحتوي على المحتوى الأصلي */
  #tables-container, #copied {
      width: 100%; /* عرض كل حاوية 50% من الحاوية الأصلية */
      padding: 5px;
      border: 1px solid #ccc;
      margin: 5px;
      height: auto;
      overflow: auto;
  }

    </style>
</head>
<body>
<div id="mother"> 
    <button id="save">save</button>
    <button onclick="calculateAll()">حساب وحفظ جميع البيانات</button>
    <button id="copy">copy</button>
</div>    
    <div id="main">
    <div  id="tables-container"></div>
    <div  id="copied"></div>
    </div>
    <script>
        // بيانات العملاء
const customers = [
{ id: 1, name: "الخطاب محمد" },
{ id: 2, name: "العنبر محمد" },
{ id: 3, name: "حسنى حمد" },
{ id: 4, name: "حسنى حسن" },
{ id: 5, name: "حسنى بوجمعة" },
{ id: 6, name: "العماري حماد" },
{ id: 7, name: "اقمري حسن" },
{ id: 8, name: "العنبر لحس" },
{ id: 9, name: "صفوان محمد" },
{ id: 10, name: "صفوان حسن" },
{ id: 11, name: "الفقير حسن" },
{ id: 12, name: "اقمران حسن" },
{ id: 13, name: "الوزي بوجمعة" },
{ id: 14, name: "الوزي محمد" },
{ id: 15, name: "اكوشام حماد" },
{ id: 16, name: "تمغريت حسن" },
{ id: 17, name: "البصراوي لحسين" },
{ id: 18, name: "تمغريت سعيد" },
{ id: 19, name: "اقمري تهامي" },
{ id: 20, name: "اقمري لحسن" },
{ id: 21, name: "اقمري عبدالله" },
{ id: 22, name: "الحمود محمد" },
{ id: 23, name: "هلال محمد" },
{ id: 24, name: "الوزي حس" },
{ id: 25, name: "تزوض المصطفى" },
{ id: 26, name: "بنعد محمد" },
{ id: 27, name: "بنعد لكبير" },
{ id: 28, name: "بنعد عبدالرحمن" },
{ id: 29, name: "المدرسة" },
{ id: 30, name: "اجوب" },
{ id: 31, name: "اجوب" },
{ id: 32, name: "القمري لحسين" },
{ id: 33, name: "بليش عبد الملك" },
{ id: 34, name: "بليش براهيم" },
{ id: 35, name: "هلال عبدالرحمن" },
{ id: 36, name: "اجوب لحسين" },
{ id: 37, name: "اجوب حماد" },
{ id: 38, name: "بليش على" },
{ id: 39, name: "بليش حسن" },
{ id: 40, name: "بليش محمد" },
{ id: 41, name: "بليش سعيد" },
{ id: 42, name: "بوشلي عبدالله" },
{ id: 43, name: "المرزوقي عبدالعالي" },
{ id: 44, name: "اقمري محمد" },
{ id: 45, name: "ؤحموا محمد" },
{ id: 46, name: "بليش حمد" },
{ id: 47, name: "العماري حسن" },
{ id: 48, name: "صبر محمد" },
{ id: 49, name: "صبري حماد" },
{ id: 50, name: "خليل محمد" },
{ id: 51, name: "سراجي حماد" },
{ id: 52, name: "زدودعبدالغني" },
{ id: 53, name: "لعلالي عمر" },
{ id: 54, name: "المصدق عبد العزيز" },
{ id: 55, name: "المصدق سليمان" },
{ id: 56, name: "الناجى محمد" },
{ id: 57, name: "الناجى عبد العزيز" },
{ id: 58, name: "الناجى لحسين" },
{ id: 59, name: "بليش جواد" },
{ id: 60, name: "لعلالي عزيز" },
{ id: 61, name: "زعفر عبد الملك" },
{ id: 62, name: "زعفر سعيد" },
{ id: 63, name: "بوعلام حسن" },
{ id: 64, name: "بوعلام عبدالله" },
{ id: 65, name: "بوعلام محمد" },
{ id: 66, name: "بوعلام المصطفى" },
{ id: 67, name: "بوعلام حماد" },
{ id: 68, name: "المغراوي لحبيب" },
{ id: 69, name: "بن لحبيب" },
{ id: 70, name: "حسنى محمد" },
{ id: 71, name: "الفقير لحسن" },
{ id: 72, name: "حسنى عبدالملك" },
{ id: 73, name: "المغراوي سعيد" },
{ id: 74, name: "المغراوي حسن" },
{ id: 75, name: "المغراوي محمد" },
{ id: 76, name: "لعلالي رضوان" },
{ id: 77, name: "الوزي لحبيب" },
{ id: 78, name: "المغراوي عبدالله" },
{ id: 79, name: "زدودلحسين" },
{ id: 80, name: "زدودمحمد" },
{ id: 81, name: "زدودحمد" },
{ id: 82, name: "الناجى حسن" },
{ id: 83, name: "الناجى عبد الرحمن" },
{ id: 84, name: "بوعلام محمد" },
{ id: 85, name: "الناجى محمد" },
{ id: 86, name: "زدودجمال" },
{ id: 87, name: "زدودعبد الرحيم" },
{ id: 88, name: "الناجى حماد" },
{ id: 89, name: "الناجى حسن" },
{ id: 90, name: "الناجى براهيم" },
{ id: 91, name: "زعفر محمد" },
{ id: 92, name: "زعفر حسن" },
{ id: 93, name: "زعفر حماد" },
{ id: 94, name: "لبحر ي لحسين" },
{ id: 95, name: "لبحري محمد" },
{ id: 96, name: "خليل حمد" },
{ id: 97, name: "لعلالي محمد" }
];

        // إنشاء الجداول عند تحميل الصفحة
        window.onload = function() {
            createTables();
            loadSavedData();
        };

        function createTables() {
            const container = document.getElementById('tables-container');
            customers.forEach(customer => {
                const tableHtml = `
<div id="container" style="border: 2px solid black; margin-top: 0px; padding: 4px;">   
     <div id="ddataTable" style="border: 2px solid black; padding: 8px;">   
     <div>
     <h1 style=" width: 96%; margin-right: 1%;">جمعية أمل تسناس للتنمية و الخدمات الاجتماعية والماء الصالح للشرب</h1>
     <hr>
     <div id="consumptionInput" style="display:;">
     <div class="form-group">
     <table style="margin-top: 10px;">
     <tr>
     <td style="font-weight: bold; text-align: right; padding: 0px; border: none; border-right: 1px solid black;" for="noCompte">العداد:</td>
     <td dir="rtl" style="text-align:; padding: 0px; border: none; border-left: 1px solid black;" id="displayMeterNumber">${customer.id}</td>
     <td style="font-weight: bold;text-align: center; padding: 0px; border: none;" for="customerName">الاسم:</td>
     <td style="text-align: right; padding: 0px; border: none; border-left: 1px solid black;" id="displayCustomerName">${customer.name}</td>
     </tr>
     <tr>
     <td style="font-weight: bold;text-align: right; padding: 0px; border: none; border-right: 1px solid black;" for="currentReading">الاستهلاك:</td>
     <td style="text-align: center; padding: 0px; border: none; border-left: 1px solid black;" ><input style="width: 20px;" id="lastMonth-${customer.id}" type="number" value=""</td>
     <td style="font-weight: bold;text-align: center; padding: 0px; border: none;" for="TotalConsumptin">المجموع:</td>
     <td style="text-align: center; padding: 0px; border: none; border-left: 1px solid black;">
     <input id="total-${customer.id}" dir="ltr" style="width: 20px; text-align: center;" type="number" value="">
     </td>
     </tr>
     </table>
     </div>
     </div>
     </div>
     <table>
     <tr>
     <td> المساهمة</td>
     <td> الاستهلاك</td>
     <td> الغرامة</td>
     <td> المجموع</td>
     </tr>
     <tr>
     <td id="fee">200</td>
     <td id="currentMonth-${customer.id}"></td>
     <td id="gharama">0</td>
     <td id="finalTotal-${customer.id}"></td>
     </tr>
     </table>
     
     <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
     <tr>
     <th style="width: 70%; padding: 15px; text-align: right; border: 1px solid #ddd;">
     <h4 style="margin: 0;">توقيع الزبون: </h4>
     </th>
     <th style="width: 30%; padding: 15px; text-align: left; border: 1px solid #ddd;">
     <h3 id="currentDate" style="margin: 0;"></h3>
     </th>
     </tr>
     </table>
     </div>
     </div>
                `;
                container.innerHTML += tableHtml;
            });
        }

        function calculateAll() {
            customers.forEach(customer => {
                const lastMonth = Number(document.getElementById(`lastMonth-${customer.id}`).value);
                const total = Number(document.getElementById(`total-${customer.id}`).value);
                
                // حساب استهلاك الشهر الحالي
                var currentMonth = total - lastMonth;
                
                // حساب المجموع النهائي (الاستهلاك × 100 + المساهمة)
                const finalTotal = (currentMonth * 100) + 200;
                
                // عرض النتائج
                document.getElementById(`currentMonth-${customer.id}`).textContent = currentMonth;
                document.getElementById(`finalTotal-${customer.id}`).textContent = finalTotal;
                document.getElementById(`lastMonth-${customer.id}`).textContent = total;
                
                // حفظ البيانات
                const customerData = {
                    lastMonth,
                    total,
                    currentMonth,
                    finalTotal
                };
                localStorage.setItem(`customer-${customer.id}`, JSON.stringify(customerData));
            });
        }

        function loadSavedData() {
            customers.forEach(customer => {
                const savedData = localStorage.getItem(`customer-${customer.id}`);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    document.getElementById(`lastMonth-${customer.id}`).value = data.total;
                    document.getElementById(`total-${customer.id}`).value = data.total;
                    document.getElementById(`currentMonth-${customer.id}`).textContent = data.currentMonth;
                    document.getElementById(`finalTotal-${customer.id}`).textContent = data.finalTotal;
                }
            });
        }
        

    </script>
<script>
    // عند النقر على زر "نسخ المحتوى"
    document.getElementById('copy').addEventListener('click', function () {
        // اختيار المحتوى من الحاوية الأولى
        const element = document.getElementById('tables-container').innerHTML;
        
        // نسخ المحتوى إلى الحاوية الثانية
        document.getElementById('copied').innerHTML = element;
        document.getElementById('mother').style.display = 'block';
    });
</script>


       <script type="text/javascript">
async function downloadPDF() {
    // إخفاء الأزرار والعناصر الأخرى
    document.getElementById('mother').style.display = 'none';
    
    // تهيئة jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4');
    
    // الحصول على بيانات العملاء
    function getAllCustomerData() {
        return customers.map(customer => {
            const data = {
                id: customer.id,
                name: customer.name,
                lastMonth: document.getElementById(`lastMonth-${customer.id}`).value,
                total: document.getElementById(`total-${customer.id}`).value,
                currentMonth: document.getElementById(`currentMonth-${customer.id}`).textContent,
                finalTotal: document.getElementById(`finalTotal-${customer.id}`).textContent
            };
            return data;
        });
    }

    // إنشاء HTML للفاتورة الواحدة
    function createInvoiceHTML(customer) {
        if (!customer) return '';
        return `
            <div class="invoice" style="padding: 10px;">
                <div id="ddataTable" style="border: 2px solid black; padding: 8px;">   
                    <div>
                        <h1 style="width: 96%; margin-right: 1%;">جمعية أمل تسناس للتنمية و الخدمات الاجتماعية والماء الصالح للشرب</h1>
                        <hr>
                        <table style="margin-top: 10px;">
                            <tr>
                                <td style="font-weight: bold; text-align: right; padding: 0px; border: none;">العداد:</td>
                                <td dir="rtl" style="text-align: right; padding: 0px; border: none;">${customer.id}</td>
                                <td style="font-weight: bold; text-align: center; padding: 0px; border: none;">الاسم:</td>
                                <td style="text-align: right; padding: 0px; border: none;">${customer.name}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold; text-align: right; padding: 0px; border: none;">الاستهلاك:</td>
                                <td style="text-align: center; padding: 0px; border: none;">${customer.lastMonth}</td>
                                <td style="font-weight: bold; text-align: center; padding: 0px; border: none;">المجموع:</td>
                                <td style="text-align: center; padding: 0px; border: none;">${customer.total}</td>
                            </tr>
                        </table>
                        <table style="width: 100%; margin-top: 10px;">
                            <tr>
                                <td>المساهمة</td>
                                <td>الاستهلاك</td>
                                <td>الغرامة</td>
                                <td>المجموع</td>
                            </tr>
                            <tr>
                                <td>200</td>
                                <td>${customer.currentMonth}</td>
                                <td>0</td>
                                <td>${customer.finalTotal}</td>
                            </tr>
                        </table>
                        <table style="width: 100%; margin-top: 10px;">
                            <tr>
                                <th style="width: 70%; padding: 15px; text-align: right;">
                                    <h4 style="margin: 0;">توقيع الزبون: </h4>
                                </th>
                                <th style="width: 30%; padding: 15px; text-align: left;">
                                    <h3 style="margin: 0;">${new Date().toLocaleDateString('ar-MA')}</h3>
                                </th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    const customers = getAllCustomerData();
    let allInvoicesHTML = '';
    
    // إنشاء صفحات الفواتير، 3 عملاء في كل صفحة مع نسختين لكل عميل
    for (let i = 0; i < customers.length; i += 3) {
        allInvoicesHTML += `
            <div class="invoice-page" style="page-break-after: always; width: 210mm; height: 297mm; padding: 10px;">
                <div class="customer-row" style="height: 33%; display: flex; margin-bottom: 10px;">
                    <div style="width: 48%;">
                        ${createInvoiceHTML(customers[i])}
                    </div>
                    <div style="width: 48%; margin-right: 4%;">
                        ${createInvoiceHTML(customers[i])}
                    </div>
                </div>
                ${customers[i+1] ? `
                    <div class="customer-row" style="height: 33%; display: flex; margin-bottom: 10px;">
                        <div style="width: 48%;">
                            ${createInvoiceHTML(customers[i+1])}
                        </div>
                        <div style="width: 48%; margin-right: 4%;">
                            ${createInvoiceHTML(customers[i+1])}
                        </div>
                    </div>
                ` : ''}
                ${customers[i+2] ? `
                    <div class="customer-row" style="height: 33%; display: flex;">
                        <div style="width: 48%;">
                            ${createInvoiceHTML(customers[i+2])}
                        </div>
                        <div style="width: 48%; margin-right: 4%;">
                            ${createInvoiceHTML(customers[i+2])}
                        </div>
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    // إنشاء عنصر مؤقت لعرض الفواتير
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = allInvoicesHTML;
    document.body.appendChild(tempDiv);
    
    // تحويل كل صفحة إلى PDF
    const pages = tempDiv.querySelectorAll('.invoice-page');
    
    const addPage = (page) => {
        return new Promise((resolve) => {
            html2canvas(page, {
                scale: 2,
                useCORS: true,
                logging: true
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const imgHeight = 297;
                
                doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                
                if (page !== pages[pages.length - 1]) {
                    doc.addPage();
                }
                
                resolve();
            });
        });
    };
    
    // إنشاء وتحميل PDF
    const generateAndSharePDF = async () => {
        for (let page of pages) {
            await addPage(page);
        }
        
        const pdfBlob = doc.output('blob');
        const pdfFile = new File([pdfBlob], 'فواتير_المياه.pdf', { type: 'application/pdf' });
        
        if (navigator.share) {
            try {
                await navigator.share({
                    files: [pdfFile],
                    title: 'فواتير المياه',
                    text: 'فواتير استهلاك المياه'
                });
                console.log('تمت مشاركة الملف بنجاح');
            } catch (error) {
                console.error('حدث خطأ أثناء المشاركة:', error);
                doc.save('فواتير_المياه.pdf');
            }
        } else {
            doc.save('فواتير_المياه.pdf');
        }
        
        document.body.removeChild(tempDiv);
        document.getElementById('mother').style.display = 'block';
    };
    
    await generateAndSharePDF();
}

// إضافة حدث النقر لزر التحميل
document.getElementById('save').addEventListener('click', downloadPDF);
       
       
       </script>
</body>
</html>